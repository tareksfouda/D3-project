<html>
<head></head>
<body>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="http://d3js.org/topojson.v1.min.js"></script>
<!-- I recommend you host this file on your own, since this will change without warning -->
<script src="http://datamaps.github.io/scripts/datamaps.world.min.js?v=1"></script>
 <h2>Datamaps Playground</h2>

<p><a href="http://datamaps.github.io/">DataMaps Project Homepage</a>
</p>
<div id="container1" style="position: relative; width: 800px; height: 900px;"></div>

<script>
//basic map config with custom fills, mercator projection
    var map = new Datamap({
        scope: 'world',
        element: document.getElementById('container1'),
        projection: 'mercator',
        geographyConfig: {
            popupOnHover: false
        },
        fills: {
            defaultFill: '#f0af0a',
            lt50: 'rgba(0,244,244,0.9)',
            gt50: 'red'
        },

        data: {

        }
    });

map.addPlugin('pins', function(layer, data, options) {
        var self = this,
            fillData = this.options.fills,
            svg = this.svg;

        if (!data || (data && !data.slice)) {
            throw "Datamaps Error - bubbles must be an array";
        }

        var bubbles = layer.selectAll('image.datamaps-pins').data(data, JSON.stringify);

        bubbles.enter()
            .append('image')
            .attr('class', 'datamaps-pin')
            .attr('xlink:href', 'https://img.clipartfest.com/b5f7aa11c04bde66e0ad8d4d80f34297_big-image-png-gps-location-icon-clipart_1911-2400.png')
            .attr('height', 40)
            .attr('width', 40)
            .attr('x', function(datum) {
            console.log('hey')
            var latLng;
            if (datumHasCoords(datum)) {
                latLng = self.latLngToXY(datum.latitude, datum.longitude);
            } else if (datum.centered) {
                latLng = self.path.centroid(svg.select('path.' + datum.centered).data()[0]);
            }
            if (latLng) return latLng[0];
        })
            .attr('y', function(datum) {
            var latLng;
            if (datumHasCoords(datum)) {
                latLng = self.latLngToXY(datum.latitude, datum.longitude);
            } else if (datum.centered) {
                latLng = self.path.centroid(svg.select('path.' + datum.centered).data()[0]);
            }
            if (latLng) return latLng[1];;
        })

            .on('mouseover', function(datum) {
            console.log('mousover!');
            var $this = d3.select(this);

            if (options.popupOnHover) {
                console.log('going', datum)
                self.updatePopup($this, datum, options, svg);
            }
        })
            .on('mouseout', function(datum) {
            var $this = d3.select(this);

            if (options.highlightOnHover) {
                //reapply previous attributes
                var previousAttributes = JSON.parse($this.attr('data-previousAttributes'));
                for (var attr in previousAttributes) {
                    $this.style(attr, previousAttributes[attr]);
                }
            }

            d3.selectAll('.datamaps-hoverover').style('display', 'none');
        })


        bubbles.exit()
            .transition()
            .delay(options.exitDelay)
            .attr("height", 0)
            .remove();

        function datumHasCoords(datum) {
            return typeof datum !== 'undefined' && typeof datum.latitude !== 'undefined' && typeof datum.longitude !== 'undefined';
        }

    });

//bubbles, custom popup on hover template
    map.pins([{
        name: 'Hot',
        centered: 'EGY',
        radius: 10,
        fillKey: 'gt50'
    }

    ], {
        popupOnHover: true,
        popupTemplate: function(data) {
            return "<div class='hoverinfo'>It is " + data.name + "</div>";
        }
    });
</script>
</body>
</html>