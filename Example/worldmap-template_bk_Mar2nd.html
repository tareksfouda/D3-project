
<!DOCTYPE html>
<meta charset="utf-8">
<<<<<<< HEAD
<title>ODU Student Demographics Project - Prototype</title>
<style>
body { 
  color: #666; 
  background: #f3f3f3; 
  font: normal 10px "Helvetica Neue", Helvetica, sans-serif; 
  margin: 2em; 
}
#map {
  border:2px solid #000;
  width:960px;
  height:550px;
}
.country {
  fill: #ccc;
  stroke: #fff;
  stroke-width: .5px;
  stroke-linejoin: round;
}

.hidden { 
  display: none; 
}
 
=======
<title>D3 Geo World Map Boilerplate | TechSlides</title>
<style>
.country:hover{
  stroke: #fff;
  stroke-width: .7px;
}
#container {
  margin:10px 10%;
  padding:20px;
  border:2px solid #d0d0d0;
  border-radius: 5px;
  height:100%;
}
.hidden { 
  display: none; 
}
>>>>>>> 3b43ec863a80217953e18c30d207621b6ac568a0
div.tooltip {
  color: #222; 
  background: #fff; 
  padding: .5em; 
  text-shadow: #f5f5f5 0 1px 0;
  border-radius: 2px; 
  box-shadow: 0px 0px 2px 0px #a6a6a6; 
  opacity: 0.9; 
  position: absolute;
}
<<<<<<< HEAD

</style>
<body>
<h1>ODU Student Demographics Project - Prototype</h1>
<br><br>
<div id="map"></div>
<div id="countryy"></div>
<select id="ddlViewBy" onchange="favMajor()">
  <option value="1">ec</option>
  <option value="2" selected="selected">cs</option>
</select>
<script src="js/d3.v3.min.js"></script>
<script src="js/queue.v1.js"></script>
<script src="js/topojson.js"></script>

<script>

var width  = 960,
    height = 550;

var color = d3.scale.category10();

var projection = d3.geo.mercator()
                .translate([480, 300])
                .scale(970);

var path = d3.geo.path()
    .projection(projection);

var svg = d3.select("#map").append("svg")
    .attr("width", width)
    .attr("height", height);

var tooltip = d3.select("#map").append("div")
    .attr("class", "tooltip");
	
var country;

queue()
    .defer(d3.json, "data/world-110m.json")
    .defer(d3.tsv, "data/world-country-names.tsv")
    .await(ready);

function ready(error, world, names) {

  var countries = topojson.object(world, world.objects.countries).geometries,
      neighbors = topojson.neighbors(world, countries),
      i = -1,
      n = countries.length;

  countries.forEach(function(d) { 
    d.name = names.filter(function(n) { return d.id == n.id; })[0].name; 
  });

var country = svg.selectAll(".country").data(countries);

  country
   .enter()
    .insert("path")
    .attr("class", "country")    
      .attr("title", function(d,i) { return d.name; })
      .attr("d", path)
      .style("fill", function(d, i) { return color(d.color = d3.max(neighbors[i], function(n) { return countries[n].color; }) + 1 | 0); });

   
    country
      .on("mousemove", function(d,i) {
        var mouse = d3.mouse(svg.node()).map( function(d) { return parseInt(d); } );

        tooltip
          .classed("hidden", false)
          .attr("style", "left:"+(mouse[0]+25)+"px;top:"+mouse[1]+"px")
          .html(d.name)
      })
      .on("mouseout",  function(d,i) {
        tooltip.classed("hidden", true)
      })
	  .on("click", function(d,i) {
	  country = d.name;
	  //console.log(country);
	  d3.select("#countryy").text(country);
	  
		favMajor();
	
});

}


	function updateBar(newData) {
	
			var country = d3.select("#countryy").text();
			console.log(country);

			var marginMaj = {top: 20, right: 20, bottom: 70, left: 40},
			widthMaj = 600 - marginMaj.left - marginMaj.right,
			heightMaj = 300 - marginMaj.top - marginMaj.bottom;

			// Parse the date / time
			var	parseDate = d3.time.format("%Y").parse;

			var x = d3.scale.ordinal().rangeRoundBands([0, widthMaj], .05);

			var y = d3.scale.linear().range([heightMaj, 0]);

			var xAxis = d3.svg.axis()
						  .scale(x)
						  .orient("bottom")
						  .tickFormat(d3.time.format("%Y"));

			var yAxis = d3.svg.axis()
						  .scale(y)
						  .orient("left")
						  .ticks(10);
	
			d3.select("#ID1").remove();

			var svgMaj = d3.select("body").append("svg").attr("id", "ID1")
						   .attr("width", widthMaj + marginMaj.left + marginMaj.right)
						   .attr("height", heightMaj + marginMaj.top + marginMaj.bottom)
					       .append("g")
						   .attr("transform", "translate(" + marginMaj.left + "," + marginMaj.top + ")");

			d3.csv("majordata.csv", function(error, data) {

			data.forEach(function(d) {
						d.date = parseDate(d.date);
						d.value = +d.value;
				});
	
			x.domain(data.map(function(d) { return d.date; }));
			y.domain([0, d3.max(data, function(d) { if (d.major == newData && d.country == country) return d.value; })]);

			svgMaj.append("g")
				.attr("class", "x axis")
				.attr("transform", "translate(0," + heightMaj + ")")
				.call(xAxis)
				.selectAll("text")
				.style("text-anchor", "end")
				.attr("dx", "-.8em")
				.attr("dy", "-.55em")
				.attr("transform", "rotate(-90)" );

			svgMaj.append("g")
				.attr("class", "y axis")
				.call(yAxis)
				.append("text")
				.attr("transform", "rotate(-90)")
				.attr("y", 6)
				.attr("dy", ".71em")
				.style("text-anchor", "end")
				.text("Count");

			var rect = svgMaj.selectAll("bar")
							.data(data)
							.enter().append("rect")
							.style("fill", "steelblue")
							.attr("x", function(d) { if (d.major == newData && d.country == country) return x(d.date); })
							.attr("width", x.rangeBand())
							.attr('y', heightMaj)
							.attr('height', 0);
	  
					rect.transition()
					.attr("height", function(d) { if (d.major == newData && d.country == country) return heightMaj - y(d.value); })
					.attr("y", function(d) { if (d.major == newData && d.country == country) return y(d.value); })
					.delay(function(d, i) { return i * 20; })
					.duration(1000)
					.ease("elastic");

		});
	}
	
	



function favMajor()
	{
		var e = document.getElementById("ddlViewBy");
		var newData = e.options[e.selectedIndex].text;
		updateBar(newData);
	}
</script>

</body>
=======
</style>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-941940-28']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>
<body>
  <h1>D3 WorldMap Boilerplate</h1>
  <p>Features a world map with custom TopoJson which includes country names and different colors based on country location.  The map is responsive and it has a zoom limit as well as pan/drag limit.  The map comes with country tooltips and resize events have delayed/throttled JavaScript execution.</p>

  <a href="http://techslides.com/responsive-d3-map-with-zoom-and-pan-limits/">Back to Article</a>

  <div id="container"></div>

<script src="js/d3.min.js"></script>
<script src="js/topojson.v1.min.js"></script>
<script>
d3.select(window).on("resize", throttle);

var zoom = d3.behavior.zoom()
    .scaleExtent([1, 8])
    .on("zoom", move);

var width = document.getElementById('container').offsetWidth-60;
var height = width / 2;

var topo,projection,path,svg,g;

var tooltip = d3.select("#container").append("div").attr("class", "tooltip hidden");

setup(width,height);

function setup(width,height){
  projection = d3.geo.mercator()
    .translate([0, 0])
    .scale(width / 2 / Math.PI);

  path = d3.geo.path()
      .projection(projection);

  svg = d3.select("#container").append("svg")
      .attr("width", width)
      .attr("height", height)
      .append("g")
      .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")")
      .call(zoom);

  g = svg.append("g");

}

d3.json("data/world-topo.json", function(error, world) {

  var countries = topojson.feature(world, world.objects.countries).features;

  topo = countries;
  draw(topo);

});

function draw(topo) {

  var country = g.selectAll(".country").data(topo);

  country.enter().insert("path")
      .attr("class", "country")
      .attr("d", path)
      .attr("id", function(d,i) { return d.id; })
      .attr("title", function(d,i) { return d.properties.name; })
      .style("fill", function(d, i) { return d.properties.color; });

  //ofsets plus width/height of transform, plsu 20 px of padding, plus 20 extra for tooltip offset off mouse
  var offsetL = document.getElementById('container').offsetLeft+(width/2)+40;
  var offsetT =document.getElementById('container').offsetTop+(height/2)+20;

  //tooltips
  country
    .on("mousemove", function(d,i) {
      var mouse = d3.mouse(svg.node()).map( function(d) { return parseInt(d); } );
        tooltip
          .classed("hidden", false)
          .attr("style", "left:"+(mouse[0]+offsetL)+"px;top:"+(mouse[1]+offsetT)+"px")
          .html(d.properties.name)
      })
      .on("mouseout",  function(d,i) {
        tooltip.classed("hidden", true)
      }); 
   
}

function redraw() {
  width = document.getElementById('container').offsetWidth-60;
  height = width / 2;
  d3.select('svg').remove();
  setup(width,height);
  draw(topo);
}

function move() {

  var t = d3.event.translate;
  var s = d3.event.scale;  
  var h = height / 3;
  
  t[0] = Math.min(width / 2 * (s - 1), Math.max(width / 2 * (1 - s), t[0]));
  t[1] = Math.min(height / 2 * (s - 1) + h * s, Math.max(height / 2 * (1 - s) - h * s, t[1]));

  zoom.translate(t);
  g.style("stroke-width", 1 / s).attr("transform", "translate(" + t + ")scale(" + s + ")");

}

var throttleTimer;
function throttle() {
  window.clearTimeout(throttleTimer);
    throttleTimer = window.setTimeout(function() {
      redraw();
    }, 200);
}

</script>
</body>
</html>
>>>>>>> 3b43ec863a80217953e18c30d207621b6ac568a0
